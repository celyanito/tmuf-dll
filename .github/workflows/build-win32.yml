name: build-win32

on:
  push:
  pull_request:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v2

      - name: Locate solution
        shell: pwsh
        run: |
          $sln = Get-ChildItem -Recurse -Filter *.sln | Select-Object -First 1
          if (-not $sln) { throw "No .sln found in repo." }
          "SLN=$($sln.FullName)" | Out-File -FilePath $env:GITHUB_ENV -Append
          Write-Host "Using solution: $($sln.FullName)"

      - name: Show solution configurations
        shell: pwsh
        run: |
          msbuild "$env:SLN" /t:ValidateSolutionConfiguration /v:m

      - name: Build (Debug | x86)
        run: msbuild "$env:SLN" /m /p:Configuration=Debug /p:Platform=x86

      - name: Upload artifact (DLL/PDB)
        uses: actions/upload-artifact@v4
        with:
          name: build-Debug-x86
          path: |
            **\Debug\*.dll
            **\Debug\*.pdb